// FIREBASE IMPORTS
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } 
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyAJ0wVPtpxbZxw5r2b6wp3LbjLOFkfnkz8",
  authDomain: "skycast-ab1c3.firebaseapp.com",
  projectId: "skycast-ab1c3",
  storageBucket: "skycast-ab1c3.firebasestorage.app",
  messagingSenderId: "742518075574",
  appId: "1:742518075574:web:68878e63c1e07a7c06b617",
  measurementId: "G-6LMJ7ENSMQ"
};

// INIT FIREBASE
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const reviewForm = document.querySelector("#reviewForm");
const nameInput = document.querySelector("#nameInput");
const reviewInput = document.querySelector("#reviewInput");
const reviewsList = document.querySelector("#reviewsList");

// ADD REVIEW
reviewForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  await addDoc(collection(db, "reviews"), {
    name: nameInput.value,
    review: reviewInput.value
  });

  nameInput.value = "";
  reviewInput.value = "";
  loadReviews();
});

// LOAD REVIEWS
async function loadReviews() {
  reviewsList.innerHTML = "";
  const snapshot = await getDocs(collection(db, "reviews"));

  snapshot.forEach((docItem) => {
    const data = docItem.data();
    const id = docItem.id;

    reviewsList.innerHTML += `
      <div class="review-item">
        <p><strong>${data.name}</strong></p>
        <p>${data.review}</p>
        <button onclick="deleteReview('${id}')">Delete</button>
      </div>
    `;
  });
}

// DELETE REVIEW
window.deleteReview = async function(id) {
  await deleteDoc(doc(db, "reviews", id));
  loadReviews();
};

loadReviews();
