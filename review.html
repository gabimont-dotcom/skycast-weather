<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>SkyCast Reviews</title>
    <link rel="stylesheet" href="style.css">

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } 
            from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

        // Your Firebase config
        const firebaseConfig = {
          apiKey: "AIzaSyAJ0wVPtpxbZxw5r2b6wp3LbjLOFkfnkz8",
          authDomain: "skycast-ab1c3.firebaseapp.com",
          projectId: "skycast-ab1c3",
          storageBucket: "skycast-ab1c3.firebasestorage.app",
          messagingSenderId: "742518075574",
          appId: "1:742518075574:web:68878e63c1e07a7c06b617",
          measurementId: "G-6LMJ7ENSMQ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // -------------------------------
        // ADD REVIEW (CREATE)
        // -------------------------------
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("reviewForm");
            const list = document.getElementById("reviewList");

            loadReviews();

            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const name = document.getElementById("name").value;
                const city = document.getElementById("city").value;
                const rating = document.getElementById("rating").value;
                const comment = document.getElementById("comment").value;

                await addDoc(collection(db, "reviews"), {
                    name,
                    city,
                    rating,
                    comment
                });

                form.reset();
                loadReviews();
            });

            // -------------------------------
            // LOAD REVIEWS (READ)
            // -------------------------------
            async function loadReviews() {
                list.innerHTML = "";
                const querySnapshot = await getDocs(collection(db, "reviews"));
                querySnapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const id = docSnap.id;

                    list.innerHTML += `
                        <div class="reviewItem">
                            <h3>${data.name} â€” ${data.city}</h3>
                            <p><strong>Rating:</strong> ${data.rating}/5</p>
                            <p>${data.comment}</p>
                            <button onclick="editReview('${id}', '${data.name}', '${data.city}', '${data.rating}', '${data.comment}')">Edit</button>
                            <button onclick="deleteReview('${id}')">Delete</button>
                        </div>
                    `;
                });
            }

            // -------------------------------
            // DELETE REVIEW
            // -------------------------------
            window.deleteReview = async (id) => {
                await deleteDoc(doc(db, "reviews", id));
                loadReviews();
            };

            // -------------------------------
            // EDIT REVIEW (UPDATE)
            // -------------------------------
            window.editReview = async (id, name, city, rating, comment) => {
                const newComment = prompt("Update your comment:", comment);
                if (!newComment) return;

                await updateDoc(doc(db, "reviews", id), {
                    comment: newComment
                });

                loadReviews();
            };
        });
    </script>
</head>

<body>
    <h1>Weather Reviews</h1>

    <form id="reviewForm">
        <input type="text" id="name" placeholder="Your Name" required>
        <input type="text" id="city" placeholder="City" required>
        <select id="rating" required>
            <option value="1">1 - Bad</option>
            <option value="2">2 - Okay</option>
            <option value="3">3 - Good</option>
            <option value="4">4 - Great</option>
            <option value="5">5 - Amazing</option>
        </select>
        <textarea id="comment" placeholder="Write a comment..." required></textarea>
        <button type="submit">Submit Review</button>
    </form>

    <h2>All Reviews</h2>
    <div id="reviewList"></div>

</body>
</html>
